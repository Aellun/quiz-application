{% extends 'Quiz/dependencies.html' %}

{% block content %}
{% load static %}
<div class="container">
    <h1>Welcome to LearnHub</h1>

    <div align="right" id="displaytimer"><b>Timer: 0 seconds</b></div>

    <form method='post' action='{% url "result" %}' id="quiz-form">
        {% csrf_token %}
        <input id='submission-token' type='hidden' name="submission_token" value="{{ submission_token }}">
        <input id='selected-category' type='hidden' name="category" value="{{ selected_category }}">
        {% for q in questions %}
        <fieldset>
            <legend>{{ forloop.counter }}. {{ q.question }}</legend>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="question{{ q.id }}" id="option1{{ q.id }}" value="option1" checked>
                <label class="form-check-label" for="option1{{ q.id }}">
                    {{ q.option1 }}
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="question{{ q.id }}" id="option2{{ q.id }}" value="option2">
                <label class="form-check-label" for="option2{{ q.id }}">
                    {{ q.option2 }}
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="question{{ q.id }}" id="option3{{ q.id }}" value="option3">
                <label class="form-check-label" for="option3{{ q.id }}">
                    {{ q.option3 }}
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="question{{ q.id }}" id="option4{{ q.id }}" value="option4">
                <label class="form-check-label" for="option4{{ q.id }}">
                    {{ q.option4 }}
                </label>
            </div>
        </fieldset>
        {% endfor %}
        <input id='timer' type='hidden' name="timer" value="">
        <br>
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
    {% block script %}
    <script>
        // JavaScript code for handling category selection and timer
        const timer = document.getElementById('displaytimer');
        const inputTag = document.getElementById('timer');
        let t = 0;
        let intervalId;

        // Function to start the timer
        const startTimer = () => {
            intervalId = setInterval(() => {
                t += 1;
                timer.innerHTML = "<b>Timer: " + t + " seconds</b>";
                inputTag.value = t;
            }, 1000);
        };

        // Event listener for radio buttons
        document.querySelectorAll('input[type="radio"]').forEach((radio) => {
            radio.addEventListener('click', () => {
                if (!intervalId) {
                    startTimer();
                }
            });
        });

        // Prevent multiple form submissions
        const form = document.getElementById('quiz-form');
        form.addEventListener('submit', (event) => {
            if (form.dataset.submitted === "true") {
                event.preventDefault();
            } else {
                form.dataset.submitted = "true";
                clearInterval(intervalId);
            }
        });
    </script>
    {% endblock script %}
</div>
{% endblock %}
